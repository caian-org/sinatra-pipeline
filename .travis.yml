sudo: required
language: generic

services:
  - docker

stages:
  - install
  - test
  - build
  - publish

jobs:
  include:
    - stage: install
      name: "Install dependencies"
      script: make install

    - stage: test
      name: "Run unit tests"
      script: make test

    - stage: build
      name: "Build the docker image"
      script: make build
      if: branch = master

    - stage: publish
      name: "Publish the application image to ECR"
      script: exit 0
      if: branch = master AND tag IS present

